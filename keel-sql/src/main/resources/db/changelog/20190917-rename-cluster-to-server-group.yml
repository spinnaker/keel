databaseChangeLog:
  - changeSet:
      id: rename-cluster-to-server-group
      author: fletch
      changes:
        - sql:
            sql: update resource set kind = 'server-group' where kind = 'cluster';
        - sql:
            sql: update resource set id = replace(id, 'ec2:cluster:', 'ec2:server-group:') where id like 'ec2:cluster:%';
        - sql:
            sql: update resource set spec = replace(spec, 'cluster', 'server-group') where spec like '%cluster%' and kind = 'keel-tag';
      rollback:
        - sql:
            sql: update resource set kind = 'cluster' where kind = 'server-group';
        - sql:
            sql: update resource set id = replace(id, 'ec2:server-group:', 'ec2:cluster:') where id like 'ec2:server-group:%';
        - sql:
            sql: update resource set spec = replace(spec, 'server-group', 'cluster') where spec like '%server-group%' and kind = 'keel-tag';
  - changeSet:
      id: rename-cluster-to-server-group-on-tag-id
      author: fletch
      changes:
        - sql:
            sql: update resource set id = replace(id, 'ec2:cluster:', 'ec2:server-group:') where id like 'tag:keel-tag:ec2:cluster:%';
      rollback:
        - sql:
            sql: update resource set id = replace(id, 'ec2:server-group:', 'ec2:cluster:') where id like 'tag:keel-tag:ec2:server-group:%';
  - changeSet:
      id: rename-cluster-to-server-group-in-resource-events
      author: fletch
      changes:
        - sql:
            sql: update resource_event set json = replace(json, '"kind":"cluster"', '"kind":"server-group"');
        - sql:
            sql: update resource_event set json = replace(json, '"id":"ec2:cluster', '"id":"ec2:server-group');
        - sql:
            sql: update resource_event set json = replace(json, '"id":"tag:keel-tag:ec2:cluster', '"id":"tag:keel-tag:ec2:server-group');
        - sql:
            sql: update resource_event set json = replace(json, '"keelId":"ec2:cluster', '"keelId":"ec2:server-group');
      rollback:
        - sql:
            sql: update resource_event set json = replace(json, '"kind":"server-group"', '"kind":"cluster"');
        - sql:
            sql: update resource_event set json = replace(json, '"id":"ec2:server-group', '"id":"ec2:cluster');
        - sql:
            sql: update resource_event set json = replace(json, '"id":"tag:keel-tag:ec2:server-group', '"id":"tag:keel-tag:ec2:cluster');
        - sql:
            sql: update resource_event set json = replace(json, '"keelId":"ec2:server-group', '"keelId":"ec2:cluster');
  - changeSet:
      id: rename-cluster-to-server-group-in-resource-metadata
      author: fletch
      changes:
        - sql:
            sql: update resource set metadata = replace(metadata, '"id":"ec2:cluster', '"id":"ec2:server-group');
        - sql:
            sql: update resource set metadata = replace(metadata, '"id":"tag:keel-tag:ec2:cluster', '"id":"tag:keel-tag:ec2:server-group');
      rollback:
        - sql:
            sql: update resource set metadata = replace(metadata, '"id":"ec2:server-group', '"id":"ec2:cluster');
        - sql:
            sql: update resource set metadata = replace(metadata, '"id":"tag:keel-tag:ec2:server-group', '"id":"tag:keel-tag:ec2:cluster');
